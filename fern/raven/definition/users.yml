# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  ids: ids.yml
  devices: devices.yml

services:
  http:
    UsersService:
      auth: true
      base-path: /v1/apps
      endpoints:
      
        createOrUpdateUser:
          docs: Creates an AppUser if doesn't exist already, or updates user properties 
          method: POST
          path: /{app_id}/users
          path-parameters:
            app_id: ids.AppId
          request: CreateOrUpdateUserRequest
          response: unknown # Not documented in Docs.
          errors: 
            - AppNotFoundError

        getUserProfile:
          docs: Gets the requested user profile
          method: GET 
          path: /{app_id}/users/{user_id}
          path-parameters:
            app_id: 
              type: ids.AppId
              docs: your app identifier
            user_id: 
              type: ids.UserId
              docs: your user identifier
          response: UserProfile
          errors: 
            - AppNotFoundError

types:
  CreateOrUpdateUserRequest:
    properties:
      user_id: 
        type: ids.UserId 
        docs: | 
          Your user identifier. 
          if user_id already exists, user properties will be updated else a new user will be created
      mobile:
        type: optional<string>  
      email:
        type: optional<string>
      whatsapp_mobile:
        type: optional<string>
        docs: Include this only when user's whatsapp mobile is different than primary mobile
      onesignal_external_id: list<string> 
      
      fcm_tokens: list<string>
      ios_tokens: list<string>

  SlackProfile: 
    properties: 
      access_token: string
      email: string
      channel_id: string
      

  UserProfile:
    properties:
      user_sid: string
      user_id: ids.UserId
      mobile: optional<string>
      email: optional<string>
      whatsapp_mobile: optional<string>
      devices: list<devices.DeviceProfile>
      created_at: integer
      updated_at: integer

  